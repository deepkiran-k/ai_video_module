<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Video Guide Generator</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  
  body { 
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    padding: 40px 20px;
    position: relative;
    overflow-x: hidden;
  }
  
  body::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url('data:image/svg+xml,<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg"><circle cx="50" cy="50" r="2" fill="white" opacity="0.1"/></svg>');
    animation: float 20s linear infinite;
  }
  
  @keyframes float {
    from { transform: translateY(0); }
    to { transform: translateY(-100px); }
  }
  
  .container { 
    max-width: 900px;
    margin: auto;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    padding: 50px;
    border-radius: 24px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    position: relative;
    z-index: 1;
    animation: slideUp 0.6s ease-out;
  }
  
  @keyframes slideUp {
    from { 
      opacity: 0;
      transform: translateY(30px);
    }
    to { 
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  h1 { 
    text-align: center;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 10px;
    letter-spacing: -1px;
  }
  
  .subtitle {
    text-align: center;
    color: #666;
    margin-bottom: 40px;
    font-size: 1.1rem;
  }
  
  .form-group {
    margin-bottom: 25px;
    animation: fadeIn 0.6s ease-out backwards;
  }
  
  .form-group:nth-child(1) { animation-delay: 0.1s; }
  .form-group:nth-child(2) { animation-delay: 0.2s; }
  
  @keyframes fadeIn {
    from { 
      opacity: 0;
      transform: translateX(-20px);
    }
    to { 
      opacity: 1;
      transform: translateX(0);
    }
  }
  
  label { 
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #333;
    font-size: 0.95rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  
  .file-input-wrapper {
    position: relative;
    overflow: hidden;
    display: inline-block;
    width: 100%;
  }
  
  .file-input-wrapper input[type="file"] {
    position: absolute;
    left: -9999px;
  }
  
  .file-input-label {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    border: 2px dashed #667eea;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: 500;
    color: #667eea;
  }
  
  .file-input-label:hover {
    border-color: #764ba2;
    background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
    transform: translateY(-2px);
  }
  
  .file-input-label::before {
    content: 'üìÅ';
    font-size: 1.5rem;
    margin-right: 10px;
  }
  
  textarea {
    width: 100%;
    padding: 15px;
    border-radius: 12px;
    border: 2px solid #e0e0e0;
    font-size: 1rem;
    font-family: inherit;
    transition: all 0.3s ease;
    background: #fff;
    resize: vertical;
    min-height: 120px;
  }
  
  textarea:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
  }
  
  button {
    width: 100%;
    padding: 18px;
    border-radius: 12px;
    border: none;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: #fff;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-top: 15px;
    text-transform: uppercase;
    letter-spacing: 1px;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
  }
  
  button:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 6px 25px rgba(102, 126, 234, 0.6);
  }
  
  button:active:not(:disabled) {
    transform: translateY(0);
  }
  
  button:disabled {
    background: linear-gradient(135deg, #ccc 0%, #999 100%);
    cursor: not-allowed;
    box-shadow: none;
  }
  
  #status {
    margin-top: 20px;
    padding: 15px;
    text-align: center;
    font-weight: 500;
    border-radius: 12px;
    animation: pulse 2s ease-in-out infinite;
    display: none;
  }
  
  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
  }
  
  .progress-container {
    margin-top: 20px;
    display: none;
  }
  
  .progress-bar {
    width: 100%;
    height: 8px;
    background: #e0e0e0;
    border-radius: 10px;
    overflow: hidden;
    margin-bottom: 10px;
  }
  
  .progress-fill {
    height: 100%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    width: 0%;
    transition: width 0.5s ease;
    border-radius: 10px;
  }
  
  .timer {
    text-align: center;
    font-size: 1.2rem;
    font-weight: 600;
    color: #667eea;
  }
  
  #video-container {
    margin-top: 30px;
    animation: slideUp 0.6s ease-out;
  }
  
  video {
    width: 100%;
    max-height: 500px;
    border-radius: 16px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    background: #000;
  }
  
  .success-message {
    background: linear-gradient(135deg, #d4fc79 0%, #96e6a1 100%);
    color: #2d6b3d;
  }
  
  .loading-message {
    background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
    color: #5a4a7f;
  }
  
  .error-message {
    background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
    color: #c21a3a;
  }
  
  .file-name {
    margin-top: 10px;
    padding: 10px;
    background: rgba(102, 126, 234, 0.1);
    border-radius: 8px;
    font-size: 0.9rem;
    color: #667eea;
    display: none;
  }
  
  @media (max-width: 768px) {
    .container {
      padding: 30px 20px;
    }
    
    h1 {
      font-size: 2rem;
    }
  }
  select {
    width: 100%;
    padding: 15px;
    border-radius: 12px;
    border: 2px solid #e0e0e0;
    font-size: 1rem;
    font-family: inherit;
    transition: all 0.3s ease;
    background: #fff;
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%27http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%27%20width%3D%27292.4%27%20height%3D%27292.4%27%3E%3Cpath%20fill%3D%27%23667eea%27%20d%3D%27M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-13%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2013l128%20128c3.6%203.6%207.8%205.4%2013%205.4s9.4-1.8%2013-5.4l128-128c3.6-3.6%205.4-7.8%205.4-13%200-4.8-1.8-9.2-5.4-12.8z%27%2F%3E%3C%2Fsvg%3E");
    background-repeat: no-repeat;
    background-position: right 15px center;
    background-size: 0.8em;
  }
  
  select:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
  }
</style>
</head>
<body>

<div class="container">
  <h1>‚ú® AI Video Guide Generator</h1>
  <p class="subtitle">Transform your videos with AI-powered guidance</p>

  <div class="form-group">
    <label for="video-input-element">Upload Video</label>
    <div class="file-input-wrapper">
      <input type="file" id="video-input-element" name="video" accept="video/*">
      <label for="video-input-element" class="file-input-label">
        Choose Video File
      </label>
    </div>
    <div class="file-name" id="fileName"></div>
  </div>

  <div class="form-group">
    <label for="prompt">Guide Prompt</label>
    <textarea id="prompt" name="prompt" placeholder="Describe what you want the video guide to focus on..."></textarea>
  </div>
  <div class="form-group">
    <label for="voice-select">Choose a Voice</label>
    <select id="voice-select" name="voice">
      <option value="nova" selected>Nova (Female, Clear)</option>
      <option value="alloy">Alloy (Male, Professional)</option>
      <option value="echo">Echo (Male, Upbeat)</option>
      <option value="fable">Fable (Male, Storyteller)</option>
      <option value="onyx">Onyx (Male, Deep)</option>
      <option value="shimmer">Shimmer (Female, Breathy)</option>
    </select>
  </div>
  <button id="generateBtn">üöÄ Generate Video</button>

  <div id="status"></div>
  
  <div class="progress-container" id="progressContainer">
    <div class="progress-bar">
      <div class="progress-fill" id="progressFill"></div>
    </div>
    <div class="timer" id="timer">Processing: 0%</div>
  </div>

  <div id="video-container"></div>
</div>

<script>
const videoInput = document.getElementById('video-input-element');
const promptInput = document.getElementById('prompt');
const voiceInput = document.getElementById('voice-select');
const generateBtn = document.getElementById('generateBtn');
const statusEl = document.getElementById('status');
const videoContainer = document.getElementById('video-container');
const fileNameEl = document.getElementById('fileName');
const progressContainer = document.getElementById('progressContainer');
const progressFill = document.getElementById('progressFill');
const timerEl = document.getElementById('timer');

let pollingInterval;
let progressInterval;
let startTime;
const PROCESSING_TIME = 480; // 8 minutes in seconds

videoInput.addEventListener('change', (e) => {
  if (e.target.files[0]) {
    fileNameEl.textContent = `üìé ${e.target.files[0].name}`;
    fileNameEl.style.display = 'block';
  } else {
    fileNameEl.style.display = 'none';
  }
});

generateBtn.addEventListener('click', async () => {
  if (!videoInput.files[0] || !promptInput.value.trim()) {
    alert("Please upload a video and enter a prompt.");
    return;
  }
  

  generateBtn.disabled = true;
  videoContainer.innerHTML = "";
  clearInterval(pollingInterval);
  clearInterval(progressInterval);
  
  updateStatus("‚è≥ Uploading video...", "loading-message");
  progressContainer.style.display = 'none';

  const formData = new FormData();
  formData.append('video', videoInput.files[0]);
  formData.append('prompt', promptInput.value);
  formData.append('voice', voiceInput.value);

  try {
    const response = await fetch('http://localhost:8000/api/generate-video', {
      method: 'POST',
      body: formData
    });

    if (!response.ok) {
      const err = await response.json();
      throw new Error(err.detail || 'Failed to start video generation.');
    }

    const data = await response.json();
    
    updateStatus("üé® Processing video....", "loading-message");
    progressContainer.style.display = 'block';
    
    startTime = Date.now();
    startProgressTimer();
    pollForVideoStatus(data.status_url, data.request_id);

  } catch (err) {
    updateStatus(`‚ùå Error: ${err.message}`, 'error-message');
    generateBtn.disabled = false;
    progressContainer.style.display = 'none';
  }
});

function startProgressTimer() {
  // Set initial text
  timerEl.textContent = 'Processing: 0%';
  progressFill.style.width = '0%';
  
  progressInterval = setInterval(() => {
    const elapsed = Math.floor((Date.now() - startTime) / 1000);
    const progress = Math.min((elapsed / PROCESSING_TIME) * 100, 99);
    
    progressFill.style.width = `${progress}%`;
    
    // --- THIS IS THE FIX ---
    // Change the text content to show the rounded percentage
    timerEl.textContent = `Processing: ${Math.floor(progress)}%`;
    // --- END FIX ---
    
    if (elapsed >= PROCESSING_TIME) {
      clearInterval(progressInterval);
    }
  }, 1000);
}

function pollForVideoStatus(statusUrl, requestId) {
  pollingInterval = setInterval(async () => {
    try {
      const response = await fetch(statusUrl);
      if (!response.ok) {
        console.warn('Polling request failed, retrying...');
        return;
      }
      const data = await response.json();

      if (data.status === 'completed') {
        clearInterval(pollingInterval);
        clearInterval(progressInterval);
        progressFill.style.width = '100%';
        // You can optionally update the text to 100% here
        timerEl.textContent = 'Processing: 100%';
        updateStatus("‚úÖ Video generated successfully!", 'success-message');
        progressContainer.style.display = 'none';
        displayVideo(requestId);
        generateBtn.disabled = false;
      } else if (data.status === 'failed') {
        clearInterval(pollingInterval);
        clearInterval(progressInterval);
        updateStatus(`‚ùå Error: ${data.error}`, 'error-message');
        progressContainer.style.display = 'none';
        generateBtn.disabled = false;
      }

    } catch (err) {
      clearInterval(pollingInterval);
      clearInterval(progressInterval);
      updateStatus(`‚ùå Polling failed: ${err.message}`, 'error-message');
      progressContainer.style.display = 'none';
      generateBtn.disabled = false;
    }
  }, 3000);
}

function displayVideo(requestId) {
  const videoUrl = `http://localhost:8000/api/video/${requestId}`;
  const videoEl = document.createElement('video');
  videoEl.src = videoUrl;
  videoEl.controls = true;
  videoEl.autoplay = true;
  videoEl.muted = true;
  videoContainer.appendChild(videoEl);
}

function updateStatus(message, className) {
  statusEl.textContent = message;
  statusEl.className = className;
  statusEl.style.display = 'block';
  if (className.includes('success') || className.includes('error')) {
    statusEl.style.animation = 'none';
  } else {
    statusEl.style.animation = 'pulse 2s ease-in-out infinite';
  }
}
</script>

</body>
</html>